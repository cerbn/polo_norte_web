{% extends 'app/base.html' %}
{% load static %}

{% block extra_css %}
<link href="{% static 'app/css/confirmacion_pago.css' %}" rel="stylesheet"> <!-- Enlace a la hoja de estilo home.css -->
{% endblock %}
{% block contenido %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: Arial, sans-serif;
    }

    .container {
        display: flex;
        flex-direction: row;
        margin: 20px;
        gap: 20px;
    }

    .book-card {
        width: 30%;
        background-color: #f9f9f9;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        text-align: left;
    }

    .book-card img {
        width: 5cm; /* Ancho fijo de 5 cm */
        height: 8cm; /* Largo fijo de 8 cm */
        object-fit: cover;
        margin-bottom: 20px;
    }

    .book-details p {
        margin: 5px 0;
        color: #333;
    }

    .book-review {
        flex-grow: 1;
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .book-review h2 {
        margin-bottom: 20px;
    }

    .price-cart-section {
        position: absolute;
        top: 20px;
        right: -200px;
        width: 180px;
        padding: 20px;
        background-color: #f1f1f1;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .price-cart-section h3 {
        color: black;
        margin-bottom: 10px;
    }
    .price-cart-section h5 {
        color: black;
        margin-bottom: 10px;
    }

    .price-cart-section input[type="number"] {
        width: 60px;
        padding: 5px;
        margin-bottom: 20px;
    }

    .price-cart-section button {
        background-color: #4CAF50;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .price-cart-section button:hover {
        background-color: #45a049;
    }

    .comments-section {
        margin-top: 30px;
        padding: 20px;
        background-color: #f0f0f0;
        border-radius: 10px;
    }

    .comment {
        margin-bottom: 20px;
    }

    .stars {
        color: gold;
        font-size: 18px;
    }

    textarea {
        width: 100%;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    button:hover {
        background-color: #45a049;
    }

    h3 {
        color: black;
    }

    label {
        color: black;
    }
    .ediciones, .ficha-tecnica, .biografia, .libros-relacionados, .opiniones, .comentario {
        padding: 20px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

    .carousel {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        }

    .edicion, .libro-relacionado {
        text-align: center;
        width: 150px;
        }

    .edicion img, .libro-relacionado img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        }

        .libros-relacionados {
            position: relative;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .carousel {
            display: flex;
            gap: 20px;
            overflow-x: scroll;
            scroll-behavior: smooth;
        }

        .carousel::-webkit-scrollbar {
            display: none;
        }

        .libro-relacionado {
            min-width: 150px;
            flex-shrink: 0;
            text-align: center;
        }

        .libro-relacionado img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
        }

        .comprar-btn {
            background-color: #FF6347;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 5px;
        }

        .comprar-btn:hover {
            background-color: #FF4500;
        }

        /* Flechas de navegación */
        .prev, .next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }

        .prev {
            left: 0;
        }

        .next {
            right: 0;
        }

        .prev:hover, .next:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
</style>

<div class="container">
    <!-- Tarjeta del libro con detalles -->
    <div class="book-card">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/1a/It_%281986%29_front_cover%2C_first_edition.jpg" alt="Portada del libro">
        <div class="book-details">
            <p><strong>Formato:</strong> {{ libro.formato }}</p>
            <p><strong>Autor:</strong> <a href="{% url 'autor_detalle' libro.autor.id %}" class="text-decoration-none">{{ libro.autor.nombre }}</a></p>
            <p><strong>Editorial:</strong> Editorial ABC</p>
            <p><strong>Año:</strong> {{ libro.anio }}</p>
            <p><strong>Idioma:</strong> {{ libro.idioma }}</p>
            <p><strong>N° Páginas:</strong> {{ libro.num_paginas }}</p>
            <p><strong>Encuadernación:</strong> {{ libro.encuadernacion }}</p>
            <p><strong>Dimensiones:</strong> {{ libro.dimensiones }}</p>
            <p><strong>ISBN:</strong> {{ libro.isbn }}</p>
            <p><strong>Categorías:</strong> {{ libro.categoria.nombre }}</p>
        </div>
    </div>

    <!-- Reseña del libro -->
    <div class="book-review">
        <h2>Reseña del Libro</h2>
        <p>{{ libro.descripcion }}</p>

                <!-- Sección de precio y añadir al carrito -->
                <div class="price-cart-section">
                    <h3>Precio: ${{ libro.precio }}</h3>
                    <label for="quantity">Cantidad:</label>
                    <input type="number" id="quantity" name="quantity" min="1" value="1"><br><br>
                    <h5>Quedan: {{ libro.stock }}</h5>
                    <button>Añadir al carrito</button>
                </div>


        <!-- Sección de biografía del autor -->
        <div class="biografia">
            <h3>Biografía del Autor</h3>
            <p>Gabriel García Márquez fue un escritor, guionista y periodista colombiano, considerado uno de los autores más importantes del siglo XX. Ganador del Premio Nobel de Literatura en 1982, es conocido principalmente por su obra maestra "Cien años de soledad", una novela que popularizó el realismo mágico. Su obra ha dejado una huella profunda en la literatura hispanoamericana y mundial.</p>
        </div>

        <div class="container">
            <!-- Sección de libros relacionados -->
            <div class="libros-relacionados">
                <h3>Libros Relacionados</h3>
                <button class="prev" onclick="scrollCarousel(-300)">&#10094;</button>
                <div class="carousel" id="related-books-carousel">
                    <div class="libro-relacionado">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/1a/It_%281986%29_front_cover%2C_first_edition.jpg" alt="Libro 1">
                        <p>Libro Relacionado 1</p>
                        <p class="price">$25.990</p>
                        <button class="comprar-btn">Comprar</button>
                    </div>
                    <div class="libro-relacionado">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/1a/It_%281986%29_front_cover%2C_first_edition.jpg" alt="Libro 2">
                        <p>Libro Relacionado 2</p>
                        <p class="price">$30.490</p>
                        <button class="comprar-btn">Comprar</button>
                    </div>
                    <div class="libro-relacionado">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/1a/It_%281986%29_front_cover%2C_first_edition.jpg" alt="Libro 3">
                        <p>Libro Relacionado 3</p>
                        <p class="price">$18.990</p>
                        <button class="comprar-btn">Comprar</button>
                    </div>
                    <div class="libro-relacionado">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/1/1a/It_%281986%29_front_cover%2C_first_edition.jpg" alt="Libro 3">
                        <p>Libro Relacionado 3</p>
                        <p class="price">$18.990</p>
                        <button class="comprar-btn">Comprar</button>
                    </div>
                </div>
                <button class="next" onclick="scrollCarousel(300)">&#10095;</button>
            </div>
        </div>






        <!-- Sección de comentarios -->
        <!-- Sección de comentarios -->
        <!-- Sección de comentarios -->
        <div class="comments-section">
            <h2>Comentarios de los usuarios</h2>

            <!-- Mostrar los comentarios existentes -->
            {% for comentario in comentarios %}
            <div class="comment">
                <p><strong><a href="#" class="text-decoration-none">{{ comentario.usuario.username }}</a></strong> 
                {% load custom_tags %}
                <span class="stars">
                    {% for i in 5|stars_range %}
                        {% if i <= comentario.calificacion %}
                            ★
                        {% else %}
                            ☆
                        {% endif %}
                    {% endfor %}
                </span>

            </p>
                <p>{{ comentario.comentario }}</p>
                <p><small>{{ comentario.fecha }}</small></p>
            </div>
            {% endfor %}

            <!-- Formulario para dejar un comentario -->
            {% if request.user.is_authenticated %}
            <h3>Deja tu comentario</h3>
            <form action="{% url 'libro_detalle' libro.id %}" method="POST" onsubmit="return validarComentario()">
                {% csrf_token %}
                <label for="rating">Calificación:</label>
                <select id="rating" name="rating" required>
                    <option value="5">★★★★★</option>
                    <option value="4">★★★★☆</option>
                    <option value="3">★★★☆☆</option>
                    <option value="2">★★☆☆☆</option>
                    <option value="1">★☆☆☆☆</option>
                </select><br><br>
                <label for="comment">Comentario:</label><br>
                <textarea id="comment" name="comment" rows="4" cols="50" placeholder="Escribe tu comentario aquí..." required></textarea><br><br>
                <button type="submit">Enviar Comentario</button>
            </form>
            <script>
                function validarComentario() {
                    var comentario = document.getElementById("comment").value.trim();
                    if (comentario === "") {
                        alert("El comentario no puede estar vacío.");
                        return false; // Evita el envío del formulario
                    }
                    return true; // Permite el envío
                }
            </script>
            {% else %}
            <p>Debes <a href="{% url 'login' %}">iniciar sesión</a> para dejar un comentario.</p>
            {% endif %}


</div>
<script>
    function scrollCarousel(distance) {
        const carousel = document.getElementById('related-books-carousel');
        carousel.scrollBy({
            left: distance,
            behavior: 'smooth'
        });
    }
</script>
{% endblock %}
